@model VL.ItsMe1110.Models.BlogListModel
@{
    ViewBag.Title = "Index";
}

<div class="jumbotron">
    <h1>篇幅:h1</h1>
    <p class="lead">
        篇幅:lead
        现在空荡荡的
    </p>
    <p>
        <a href="@Url.Action("Edit",new { id=Guid.Empty, title =""})" class="btn btn-primary btn-lg">新增 »</a>
    </p>
</div>
<div class="row">
    @foreach (var blog in Model.OrderByDescending(c => c.CreatedTime))
    {
        <div class="col-md-4">
            <h2>@blog.Title</h2>
            <p class="TextBreviary">@blog.BreviaryContent</p>
            <a class="btn btn-default" href="@Url.Action("Edit", new { id = blog.BlogId, title = blog.Title })">编辑 »</a>
            @{
                var value = blog.IsVisible ? "隐藏" : "显示";
                <a class="visibility btn btn-default" value="@blog.BlogId">@value »</a>
            }
        </div>}
</div>

@section Scripts {
    @Scripts.Render(BundleConfig.JQueryBundle)
    <script>
        $(".visibility").click(function () {
            //alert($(this).attr("value"))
            //alert($(this).text())
            //alert($(this).text() == "显示 »")
            control = $(this)
            id = control.attr("value")
            isVisible = control.text() == "显示 »"
            $.ajax({
                type: 'POST',
                url: "/Blog/ChangeVisibility",
                data: "id=" + id + "&isVisible=" + isVisible,
                success: function (msg) {
                    if (msg == "True") {
                        if (isVisible) {
                            control.text("隐藏 »")
                        } else {
                            control.text("显示 »")
                        }
                    }
                    else {
                        alert("更新失败,请刷新页面后重试")
                    }
                },
                error: function (msg) {
                    alert("处理过程出现异常,请刷新页面后重试");
                },
            })
        });
    </script>
}